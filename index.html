<html>
<head>
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="http://requirejs.org/docs/release/2.1.18/minified/require.js"></script>
</head>
<body>
<select id="ports-in"></select>
<select id="ports-out"></select>
</body>
<script>

    requirejs(['midi'], function (midi) {
        var mgw = new midi.Gateway();
        var $inSelector = $('#ports-in');
        var $outSelector = $('#ports-out');

        mgw.checkCompatibility(function(){
            mgw.getAvailableInputs().forEach(function(port) { addPortToSelector($inSelector, port); });
            mgw.selectInput($inSelector.val());
            $inSelector.on('change', function(){ mgw.selectInput($inSelector.val()); });

            mgw.getAvailableOutputs().forEach(function(port) { addPortToSelector($outSelector, port); });
            mgw.selectOutput($outSelector.val());
            $outSelector.on('change', function(){ mgw.selectOutput($outSelector.val()); });
        }, function(err){
            alert(error);
        });

        var addPortToSelector = function($e, port){
            var opt = document.createElement("option");
            opt.text = port.manufacturer + ' ' + port.name + ' ' + port.type;
            opt.value = port.id;
            $e.append(opt);
        };

        debugger;
    });

//    var ts = 0;
//    var cnt = 0;
//
//    var incb = function(port){
//        port.onmidimessage = function(e){
//            if(e.data.length == 1 && e.data[0] == 0xF8){
//                if(++cnt % 24 == 0){
//                    console.log( Math.round(1000/(e.timeStamp - ts)*60) );
//                    ts = e.timeStamp;
//                }
//            }
//        };//)
//    };
//
//    var outcb = function(port){
//        //port.send([0xFA]);
//        //setInterval(function(){ port.send([0xF8]); }, 40);
//    };


</script>
</html>

